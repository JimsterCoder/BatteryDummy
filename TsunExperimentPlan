These are all to be done with spoof BMS messages and no actual BMS on the Leaf Battery.
It is reccomended that we monitor the Leaf BMS via savvy CAN to ensure we don't push the battery beyond its safe cell and overall voltage limits.

1/
Adjust spoofed data to to limit power to 1kW (@390V ~2.5A) and tighter (very safe) voltage limits.
*ChargeCutoffVolt = 390
*DischargeCutoffVolt = 380
MaxChargeCur = 2.5
MaxDischargeCur = -1.5

Run inverter on 
A'force charge' & 
B 'Self Use'modes.
Observe if these limits are observed
-Side project see if the sign on charge currrent makes a difference.

RESULTS:
Inverter observed MaxChargeCur and ChargeCutoffVolt.
After changing settings to Self Use the inverter sent out a request for battery to sleep (8201, 55). It did this regardless of what mode I tried.
Modifying code to acknowledge this request and also switch on contactors on reeeipt of Inverter traffic did not change this behaviour.
Ideas:
DONE C Adjust spoofed voltage to actual batt voltage now it's charged up
NO NEED D operate contactors based on received 8201 mode request. Possibly prepare for 8211 requests also.

**DischargeCutoffVolt not observed. Discharged to 374V without stopping
Given this worth double checking that ChargeCutoffVolt is observed based on the inverter's own measurements of battery voltage
Tested by setting ChargeCutoffVoltto 376V.
Inverter tapered current down as its displayed voltage reached the voltage limit, even though our reported voltage was still well below the limit.
DischargeCutoffVolt tested again and again found to be dependent on our reported voltage, not the inverter's own measured voltage (discharged to 370V despite limit being 374V)

Changed BattPileVolt to 374V and discharge stopped immediately, followed by 8201 sleep request.
Changed DischargeCutoffVolt to 372V and it immediately started the 'getting ready to charge' process again.
Switched to charge battery mode (within the 'peak trough' setting) and it happily set off charging the battery, still with no wake command.

Seems as though it will not begin discharge if its measured battery voltage is below DischargeCutoffVolt
It also will not start charging if the two are very close. As part of the charge intialisation process it draws power from the battery (-192W observed) and this drops the measured its voltage.
If the measured value drops below DischargeCutoffVolt it ceases the charge prep process


2/ Adjust spoofed SOC to be outside of inverter's limits (95% & 15%).
See if inverter will behave appropriately.
A/ SOC @96%
Inverter stopped charging immediately
Inverter happy to discharge at this SOC
B/ SOC @95%
Inverter happy to charge & discharge at this SOC

C/ SOC 14%


B/Soc 14%


3/?
